{% extends "base.html" %}

{% block content %}
  <div class="topbar">
    <div>
      <div style="font-weight: 700; font-size: 16px;">Workflow Monitor</div>
      <div class="muted" style="font-size: 13px;">From <code>state/topics/*/status.json</code> (read-only)</div>
    </div>
  </div>

  <div style="height: 14px;"></div>

  <div class="panel">
    <div class="md">
      <table>
        <thead>
          <tr>
            <th>Topic</th>
            <th>Stage</th>
            <th>State</th>
            <th>Worker</th>
            <th>Run</th>
            <th>Updated</th>
            <th>Record</th>
          </tr>
        </thead>
        <tbody>
          {% for s in statuses %}
            <tr>
              <td><a href="/topics/{{ s.topic_id }}">{{ s.topic_id }}</a></td>
              <td>{{ s.stage if s.stage else "-" }}</td>
              <td><span class="pill {{ pill_class(s.stage_state) }}">{{ s.stage_state if s.stage_state else "-" }}</span></td>
              <td>{{ s.worker_id if s.worker_id is not none else "-" }}</td>
              <td>{{ s.run_id if s.run_id else "-" }}</td>
              <td>{{ s.ts if s.ts else "-" }}</td>
              <td>
                {% if s.record_filename %}
                  <a href="/topics/{{ s.topic_id }}/runs/{{ s.record_filename }}">{{ s.record_filename }}</a>
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if missing_topics|length > 0 %}
      <div style="height: 12px;"></div>
      <div class="muted" style="font-size: 13px;">
        No status yet: {% for t in missing_topics %}<code>{{ t }}</code>{% if not loop.last %}, {% endif %}{% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}

