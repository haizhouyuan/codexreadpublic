{% extends "base.html" %}

{% block content %}
  <div class="topbar">
    <div>
      <div style="font-weight: 700; font-size: 16px;">
        <a href="/topics/{{ topic_id }}" style="color: inherit; text-decoration: none;">{{ topic_id }}</a>
      </div>
      <div class="muted" style="font-size: 13px;">Tasks (from state/tasks.sqlite)</div>
    </div>
    <div class="muted" style="font-size: 13px;">
      Total: <code>{{ tasks_total }}</code>
    </div>
  </div>

  {% set page = 'tasks' %}
  {% include "partials_topic_tabs.html" %}

  {% if not tasks_db_exists %}
    <div class="panel">
      <div class="muted">tasks DB not found. Expected: <code>state/tasks.sqlite</code></div>
    </div>
  {% else %}
    <div class="panel">
      {% for status, rows in tasks_grouped.items() %}
        {% if rows|length > 0 %}
          <h3 style="margin-top: 0;">{{ status }} <span class="muted">({{ rows|length }})</span></h3>
          <div class="list" style="margin-bottom: 14px;">
            {% for t in rows %}
              <div class="item">
                <h3 style="margin:0;">{{ t.title }}</h3>
                <div class="sub" style="margin-top:8px;">
                  <span class="pill">{{ t.id }}</span>
                  {% if t.category %}<span class="pill">{{ t.category }}</span>{% endif %}
                  {% if t.priority %}<span class="pill">{{ t.priority }}</span>{% endif %}
                  {% if t.source %}<span class="pill">{{ t.source }}</span>{% endif %}
                  {% if t.updated_at %}<span class="pill">{{ t.updated_at }}</span>{% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
      {% if tasks_total == 0 %}
        <div class="muted">No tasks for this topic.</div>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

